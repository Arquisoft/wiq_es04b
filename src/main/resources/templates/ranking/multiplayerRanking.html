<!DOCTYPE html SYSTEM "http://www.thymeleaf.org/dtd/xhtml1-strict-thymeleaf-spring4-4.dtd">
<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragments/head}"></head>
<body class="d-flex flex-column min-vh-100">
<link th:href="@{/css/multiplayer.css}" rel="stylesheet" type="text/css"/>
<canvas th:replace="~{fragments/background}"></canvas>
<nav th:replace="~{fragments/nav}"></nav>

<div class="container" style="text-align: center">
    <h2 th:text ="#{multi.info}"></h2>
    <code id="lobbyCode" th:text="${code}"></code>

    <div class="table-responsive">
        <ul id="playerList"></ul>
    </div>

    <a th:href="@{'/'}">
        <button id="createBtn" type="button" class="btn btn-custom btn-block mb-2" th:text="#{multi.menu}"></button>
    </a>
</div>

<footer th:replace="~{fragments/footer}"/>

</body>
</html>

<script>
    $(document).ready(function() {
        function updatePlayerList() {
            const code = [[${code}]];
            $.ajax({
                url: '/endGameList/' + code,
                type: 'GET',
                dataType: 'json',
                success: function (response) {
                    $('#playerList').empty();
                    $.each(response, function(playerName, playerPoints) {
                        $('#playerList').append('<li><span class="playerName">' + playerName + '</span>: <span class="playerStatus">' + playerPoints + '</span></li>');
                    });
                },
                error: function (xhr, status, error) {
                    console.error('Error al actualizar la lista de jugadores:', error);
                }
            });
        }
        setInterval(updatePlayerList, 1000);
    });
</script>
